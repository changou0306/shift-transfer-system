# Shift Transfer System (シフト転記システム)

Google Apps Scriptを使用したシフトデータの自動転記システムです。複数のスタッフのシフト情報を効率的に個人用スプレッドシートに転記します。

## 概要

このシステムは、マスタースプレッドシートから各スタッフの個人用スプレッドシートへシフト情報を自動的に転記します。最大70人の同時処理にも対応できるよう、パフォーマンスが最適化されています。

## 主な機能

- **シフトデータの自動転記**: マスターシートから個人シートへの一括転記
- **月選択プルダウン**: 今月・来月をプルダウンで簡単選択（カレンダー方式から改良）
- **店舗名称マスター**: 略称から正式名称への自動変換機能
- **カスタムプロジェクト対応**: プロジェクト名に応じた詳細情報の自動付与
- **リソース・店舗情報の自動付与**: シフトに関連する会場・内容情報の追加
- **OJTデータの転記**: 研修情報の自動反映
- **既存データの保持**: 補足事項と稼働時間の保護

## パフォーマンス最適化

このシステムは以下の最適化により、高速な処理を実現しています：

### 最適化前
- 2人同時処理: 約40秒
- 1人あたり: 約20秒
- 70人同時処理: 約2800秒（47分）

### 最適化後
- 2人同時処理: 約8-10秒
- 1人あたり: 約4-5秒
- 70人同時処理: 約350秒（6分）

### 最適化手法
1. **スプレッドシートキャッシング**: `SpreadsheetApp.openById()`の呼び出しを削減
2. **カスタムプロジェクトデータの事前読み込み**: シート読み込みを1回に集約
3. **メンバー情報の一括取得**: マスターシートへのアクセスを最小化
4. **一括データ読み込み**: 31回の個別読み込みを2回の一括読み込みに削減

## ファイル構成

- `tenki.js`: メインの転記処理スクリプト（ES6+で記述）
- `sample.js`: オリジナルのバックアップファイル
- `sample_refactored.js`: リファクタリング版（旧バージョン）

## シート構成

システムは以下のシートで構成されています：

1. **マスターシート**: スタッフ一覧と転記設定
   - フォルダID設定（G2セル）
   - 月選択プルダウン（G5セル）
   - スタッフ選択チェックボックス（A列）

2. **ID管理シート**: 固定メンバーのスプレッドシートID管理
   - 名前とスプレッドシートIDの紐付け

3. **個別案件設定シート**: リソースに登録されていない案件の情報
   - 案件名、会場、内容、稼働時間などの設定
   - 平日/土日祝の条件分岐対応

4. **店舗名称マスターシート**: 店舗の略称と正式名称の管理
   - 略称（元シフト表の案件名）
   - 正式名称（転記時に使用する店舗名）
   - 「店頭ヘルパー」「軒先販売」の会場名に反映

## 技術仕様

- **言語**: JavaScript (ES6+)
- **プラットフォーム**: Google Apps Script (V8ランタイム)
- **主要API**: SpreadsheetApp, Logger

## 使用方法

### 初期設定

1. Google Apps Scriptエディタでプロジェクトを開く
2. `tenki.js`のコードを配置
3. V8ランタイムが有効になっていることを確認
4. 必要な権限を承認
5. メニューから「⚙️ マスター初期設定」を実行
   - マスターシート、ID管理シート、個別案件設定シート、店舗名称マスターシートが作成されます

### 日常の使用

1. **ID管理シート**に固定メンバーを登録
   - 名前とスプレッドシートIDを入力

2. **マスターシート**の設定
   - G2セルに元シフト表のフォルダIDを入力
   - G5セルのプルダウンで転記対象月を選択（今月/来月）

3. **店舗名称マスターシート**に店舗情報を登録
   - 略称に元シフト表の案件名（番号なし）を入力
   - 正式名称に転記時に使用する店舗名を入力

4. **マスターシート更新**を実行
   - 元シフト表から名前を取得し、マスターシートに反映

5. **転記対象を選択**
   - A列のチェックボックスで転記したいスタッフを選択

6. **転記実行**
   - メニューから「✅ チェックした人を転記」を実行

## 設定

システムの動作は`CONFIG`オブジェクトで制御されています：

- **シート名の設定**: 各シートの名称定義
- **列番号の定義**: データ配置の列位置
- **行番号の定義**: データ配置の行位置
- **カラーコードの設定**: 曜日や状態による色分け
- **月選択プルダウン設定**: G4（ラベル）、G5（プルダウン）
- **店舗名称マスター設定**: 略称、正式名称、備考の列定義

### 店舗名称マスターの検索ロジック

1. **完全一致**: 案件名（番号除去後）と略称が完全一致する場合
2. **部分一致**: 案件名に略称が含まれる、または略称に案件名が含まれる場合
3. 例: 「テラス湘南」を登録すると「テラス湘南①」「テラス湘南②」すべてに適用

## 開発履歴

- **v1.0**: 初期リリース
- **v2.0**: ES6+リファクタリング（const/let、アロー関数、テンプレートリテラル）
- **v3.0**: パフォーマンス最適化（キャッシング、一括処理）
- **v4.0**: UI/UX改善と店舗名称マスター機能追加
  - カレンダー方式からプルダウン方式への変更
  - 店舗名称マスターシート機能の追加
  - 略称から正式名称への自動変換
  - 月プルダウン更新メニューの追加
  - 使い方説明の改善

## ライセンス

本プロジェクトは私的利用を目的としています。

## 貢献

このプロジェクトは個人プロジェクトですが、改善提案やバグレポートは歓迎します。

---

**注意**: このシステムはGoogle Apps Scriptの制限（実行時間、APIコール制限など）に従います。大規模な処理を行う場合は、適切なエラーハンドリングとリトライ機構の実装を推奨します。
